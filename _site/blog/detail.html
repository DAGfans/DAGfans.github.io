<!DOCTYPE html>
<html prefix="og:http://ogp.me/ns#">
<head>
    <title>Blog | DAG fans</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="keywords" content="blog , }developer, technical director, web, website, programming, Javascript, HTML, CSS, Action Script, openFrameworks, Unity, C++, C#, digital contents">
    <meta name="description" content="Blog for DAG fans.">
    <meta property="og:title" content="DAG fans">
    <meta property="og:description" content="Blog for DAG fans.">
    <meta property="og:url" content="https://tkmh.me/">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://tkmh.me/assets/img/ogp.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="DAG fans">
    <meta name="twitter:description" content="Blog for DAG fans.">
    <meta name="twitter:image" content="https://tkmh.me/assets/img/ogp.png">
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="stylesheet" media="all" href="/assets/css/common.css" type="text/css">
    <link rel="stylesheet" media="all" href="/assets/css/blog.css" type="text/css">
    <script class="nosync">
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-51331170-1', 'auto');
        ga('send', 'pageview');

    </script>
</head>
<body class="blog ">
<div id="wrapper">
    <div id="loading">
        <p>Loading...</p>
    </div>
    <header id="globalHeader">
        <div class="inner">
            <h1><a href="/">DAG fans<span class="txt">
                <svg viewBox="20 15 400 100">
                  <use xlink:href="#logoTxt2"></use>
                </svg></span><!-- span class="mark">
                <svg viewBox="0 0 134.4 173.9">
                  <use xlink:href="#logoMark"></use>
                </svg></span --></a></h1>
            <nav id="globalNav">
                <ul>
    <li class="index"><a href="/">Top</a></li>
    <!-- li class="works"><a href="/works/">Works</a></li -->
    <li class="blog"><a href="/blog/">Blog</a></li>
    <li class="GitHub"><a href="https://DAGfans.org">GitHub</a></li>
    <!-- li class="bookmarks"><a href="/bookmarks/">Bookmarks</a></li -->
    <!-- li class="about"><a href="/about/">About</a></li -->
</ul>

            </nav>
        </div>
        <p id="btnMenu"><a href="#"><span></span><span></span><span class="txt">menu</span></a></p>
    </header>
    <section id="mainVisual">
        <canvas></canvas>
        <div class="shadow"></div>
        <p class="loadingTxt">Loading...</p>
        <p class="btnScroll"><a href="#">Scroll</a></p>
    </section>
    <section id="contents">
        <div id="contentsInner">
           <header class="contentsTtl">
    <h1>Blog</h1>
    <h2>Blog for DAG fans.</h2>
</header>
<section class="hasCategories" id="searchPanel">
    <p class="btnCategories closed"><a href="#">Categories</a></p>
    <div class="categories closed">
        <ul>
            
            <li><a href="/blog/categories/cookies">cookies (3)</a></li>
            
            <li><a href="/blog/categories/baking">baking (5)</a></li>
            
        </ul>
    </div>
    <p class="btnTags closed"><a href="#">Tags</a></p>
    <div class="tags closed">
        <ul>
            
            <li><a href="/blog/tags/bread">bread (2)</a></li>
            
        </ul>
    </div>
    <p class="btnMonthlyArchives closed"><a href="#">Monthly Archives</a></p>
    <div class="monthlyArchives closed">
        <ul>
            
            
            
            <li>
                <a href="/blog/archives/2017/04">
                    <span class="year">2017</span>
                    <span class="month">04</span>
                </a>
            </li>
            
            
            
            
            
            <li>
                <a href="/blog/archives/2016/06">
                    <span class="year">2016</span>
                    <span class="month">06</span>
                </a>
            </li>
            
            
            
            
            
            <li>
                <a href="/blog/archives/2016/05">
                    <span class="year">2016</span>
                    <span class="month">05</span>
                </a>
            </li>
            
            
            
            
            
            <li>
                <a href="/blog/archives/2016/04">
                    <span class="year">2016</span>
                    <span class="month">04</span>
                </a>
            </li>
            
            
            
            
            
            
        </ul>
    </div>
    <p class="btnKeyword closed"><a href="#">Keyword</a></p>
    <div class="keyword closed">
        <form>
            <input type="text"/>
            <p class="btnSubmit"><a href="#">Search</a></p>
        </form>
    </div>
    <p class="btnBack"><a href="#">Back</a></p>
</section>
<div class="inner">
    <article class="main">
    <h1 class="ttl">ブログのタイトル</h1>
    <p class="date">2016.06.21</p>
    <section class="category">
        <h2 class="ttl">Category</h2>
        <div class="categories">
            <ul>
                <li><a href="#">tagtag (10)</a></li>
                <li><a href="#">tagtag (10)</a></li>
                <li><a href="#">tagtag (10)</a></li>
                <li><a href="#">tagtag (10)</a></li>
            </ul>
        </div>
    </section>
    <section class="tag">
        <h2 class="ttl">Tags</h2>
        <div class="tags">
            <ul>
                <li><a href="#">tagtag (10)</a></li>
                <li><a href="#">tagtag (10)</a></li>
                <li><a href="#">tagtag (10)</a></li>
                <li><a href="#">tagtag (10)</a></li>
            </ul>
        </div>
    </section>
    <div class="inner">
        <div class="body">
            <p>さていよいよ最終回です。<a href="https://tkmh.me/blog/2016/12/06/578/">前回 (Vol.2 Geometry編)</a>は主にBufferGeometryのお話でした。
            </p>
            <p>・<a href="https://tkmh.me/blog/2016/12/05/555/">Vol.1 (準備編)</a><br/>
                ・<a href="https://tkmh.me/blog/2016/12/06/578/">Vol.2 (Geometry編)</a><br/>
                ・Vol.3 (シェーダ編)</p>
            <p>やっとここからシェーダの話になります。シェーダのプログラムはHTMLファイルに記述されています。</p>
            <p>まずはコード量の少ないフラグメントシェーダを見てみましょう。</p>
            <h2 style="font-size: 18px; font-weight: bold; margin-bottom: 1em; margin-top: 2em;">フラグメントシェーダ</h2>
            <p><code></p>
            <pre class="glsl">
                  precision mediump float;

                  uniform sampler2D txtTexture;  // テクスチャ

                  varying vec4 vColor;  // 文字色
                  varying vec2 vUv;     // UV座標

                  // メインの処理
                  void main(){
                  vec4 color = texture2D(txtTexture, vUv) * vColor;
                  if(color.a == 0.0) {
                  discard;
                  } else {
                  gl_FragColor = color;
                  }
                  }

                  </pre>
            <p></code></p>
            <p>1行目のprecision宣言に関しては、何度も言いますが<a href="https://wgld.org/d/webgl/w070.html" target="_blank">wgld.org</a>をご覧ください。
            </p>
            <p>txtTextureはテクスチャです。複数の文字がグリッド状に並べられたものです。RawShaderMaterialのuniformsプロパティに設定したかと思います。</p>
            <p class="img"><img src="https://tkmh.me/blog/wp/wp-content/uploads/2016/12/img6.png" alt="img6"
                                class="alignnone size-full wp-image-607"
                                srcset="https://tkmh.me/blog/wp/wp-content/uploads/2016/12/img6.png 2057w, https://tkmh.me/blog/wp/wp-content/uploads/2016/12/img6-300x76.png 300w, https://tkmh.me/blog/wp/wp-content/uploads/2016/12/img6-768x193.png 768w, https://tkmh.me/blog/wp/wp-content/uploads/2016/12/img6-1024x258.png 1024w"
                                sizes="(max-width: 2057px) 100vw, 2057px"/></p>
            <p>これです。これが渡されてきます。</p>
            <p><code></p>
            <pre class="glsl">
                  varying vec4 vColor;  // 文字色
                  varying vec2 vUv;     // UV座標
                  </pre>
            <p></code></p>
            <p>これらは、頂点シェーダから渡される値です。頂点シェーダの解説の際にどんなデータが入ってくるか解説します。ひとまずコメントの通り、文字色とUV座標が入ってくると思ってください。</p>
            <p>そしてmain関数がメインの処理です。フラグメントシェーダはこの関数内でgl_FragColorに代入された値が描画されます。</p>
            <p><code></p>
            <pre class="glsl">
                  vec4 color = texture2D(txtTexture, vUv) * vColor;
                  </pre>
            <p></code></p>
            <p>この一行は何をしているかというと、テクスチャからUV座標に該当する部分の色を取ってきたものと、vColor (文字色)を乗算しています。</p>
            <p>文字のテクスチャは、文字部分は白、それ以外の部分透明なテクスチャです。(上のテクスチャの画像は透明部分をわかりやすいように黒くしているだけです。)</p>
            <p>この乗算は文字の部分だけをvColorにしてくれます。</p>
            <p>ここで、すぐ</p>
            <p><code></p>
            <pre class="glsl">
                  gl_FragColor = color;
                  </pre>
            <p></code></p>
            <p>としてしまってもいいんですが、これだと透明な部分も描画されてしまいます。</p>
            <p class="img"><img src="https://tkmh.me/blog/wp/wp-content/uploads/2016/12/img7.png" alt="img7"
                                class="alignnone size-full wp-image-617"
                                srcset="https://tkmh.me/blog/wp/wp-content/uploads/2016/12/img7.png 800w, https://tkmh.me/blog/wp/wp-content/uploads/2016/12/img7-300x150.png 300w, https://tkmh.me/blog/wp/wp-content/uploads/2016/12/img7-768x384.png 768w"
                                sizes="(max-width: 800px) 100vw, 800px"/></p>
            <p>どういうことかというと、このように、色はないけど矩形の後ろは描画できないという現象が起こってしまいます。<br/>
                なので、色が透明な部分はそもそも描画しない、という処理を入れてます。</p>
            <p>それが以下の部分です。</p>
            <p><code></p>
            <pre class="glsl">
                  if(color.a == 0.0) {
                  discard;
                  } else {
                  gl_FragColor = color;
                  }
                  </pre>
            <p></code></p>
            <p>計算した色のa成分が0の場合はdiscard;という部分に差し掛かり、discardの場合はフラグメントシェーダはなにも描画しないことになります。</p>
            <p>そうすると、矩形内でも透明部分は描画されないので、不自然に他のオブジェクトが切り取られることがなくなります。</p>
            <p>続いて頂点シェーダです。フラグメントシェーダに比べてコード量が多いですが、順に見ていけば大して難しいことはしていないです。</p>
            <h2 style="font-size: 18px; font-weight: bold; margin-bottom: 1em; margin-top: 2em;">頂点シェーダ</h2>
            <p>頂点シェーダは長いので、小分けにしてみていきます。</p>
            <h3 style="font-size: 16px; font-weight: bold; margin-bottom: 1em; line-height: 1.4;">
                ・three.jsが予め定義してるuniform変数</h3>
            <p><code></p>
            <pre class="glsl">
                  // three.jsが予め定義してるuniform変数
                  uniform mat4 modelMatrix;  // モデル変換行列
                  uniform mat4 viewMatrix;  // ビュー変換行列
                  uniform mat4 projectionMatrix;  // プロジェクション変換行列
                  uniform vec3 cameraPosition;  // カメラの位置
                  </pre>
            <p></code></p>
            <p>まずは各種変数の宣言部分です。上記のものはthree.jsが勝手にシェーダに渡してくれているuniform変数です。なので、RawShaderMaterilのuniformsには定義していません。</p>
            <h3 style="font-size: 16px; font-weight: bold; margin-bottom: 1em; line-height: 1.4;">・自分で定義したuniform変数</h3>
            <p><code></p>
            <pre class="glsl">
                  // 自分で定義したuniform変数
                  uniform float time;  // 経過時間
                  uniform float numChars;  // 文字数 (正方形の数)
                  uniform float numTextureGridRows;  // テクスチャの横方向の文字数
                  uniform float numTextureGridCols;  // テクスチャの縦方向の文字数
                  uniform float textureTxtLength;  // テクスチャに使っている文字の数
                  uniform float animationValue1;  // アニメーション適用度1
                  uniform float animationValue2;  // アニメーション適用度2
                  uniform float animationValue3;  // アニメーション適用度3
                  </pre>
            <p></code></p>
            <p>これらはRawShaderMaterialのuniformsに自分で設定したかと思います。</p>
            <h3 style="font-size: 16px; font-weight: bold; margin-bottom: 1em;">・attribute</h3>
            <p><code></p>
            <pre class="glsl">
                  // FloatingCharsGeometryで追加したattribute
                  attribute vec3 position;  // 座標
                  attribute vec3 randomValues;  // ランダム値
                  attribute vec2 uv;  //UV座標
                  attribute float charIndex;  // 何番目の文字(正方形に)属するか
                  </pre>
            <p></code></p>
            <p>これらはFloatingCharsGeometryで追加したattributeです。</p>
            <h3 style="font-size: 16px; font-weight: bold; margin-bottom: 1em;">・varying</h3>
            <p><code></p>
            <pre class="glsl">
                  // フラグメントシェーダに渡す値
                  varying vec4 vColor;  // 文字色
                  varying vec2 vUv;  // UV座標
                  </pre>
            <p></code></p>
            <p>これらはフラグメントシェーダに渡す値です。頂点ごとにこの変数に代入すると、値を補間してフラグメントシェーダに渡してくれます。</p>
            <p>値を補間？って思う方もいるかと思いますが、頂点ごとに実行される頂点シェーダに対し、フラグメントシェーダは、頂点で囲まれた面の全てのピクセルに対して実行されます。</p>
            <p>そこでvarying修飾子を付けた変数に値を入れてフラグメントシェーダに渡すと、勝手に頂点間のピクセルに対する値に補間してくれます。</p>
            <h3 style="font-size: 16px; font-weight: bold; margin-bottom: 1em;">・定数PI</h3>
            <p><code></p>
            <pre class="glsl">
                  // 定数としてPIを定義
                  const float PI = 3.1415926535897932384626433832795;
                  </pre>
            <p></code></p>
            <p>GLSLではPIが定義されていないので、自分で定数として定義しておきます。</p>
            <h3 style="font-size: 16px; font-weight: bold; margin-bottom: 1em;">・rotateVec3関数</h3>
            <p><code></p>
            <pre class="glsl">
                  // 3次元ベクトルを任意の軸で回転
                  vec3 rotateVec3(vec3 p, float angle, vec3 axis){
                  vec3 a = normalize(axis);
                  float s = sin(angle);
                  float c = cos(angle);
                  float r = 1.0 - c;
                  mat3 m = mat3(
                  a.x * a.x * r + c,
                  a.y * a.x * r + a.z * s,
                  a.z * a.x * r - a.y * s,
                  a.x * a.y * r - a.z * s,
                  a.y * a.y * r + c,
                  a.z * a.y * r + a.x * s,
                  a.x * a.z * r + a.y * s,
                  a.y * a.z * r - a.x * s,
                  a.z * a.z * r + c
                  );
                  return m * p;
                  }
                  </pre>
            <p></code></p>
            <p>rotateVec3はその名の通り、3次元ベクトルを任意の軸で回転させる関数です。</p>
            <p>第一引数に頂点座標、第二引数に角度 (ラジアン)、第三引数に軸のベクトルを指定します。正方形を回転させるために使用します。</p>
            <h3 style="font-size: 16px; font-weight: bold; margin-bottom: 1em;">・map関数</h3>
            <p><code></p>
            <pre class="glsl">
                  // 範囲を設定し直す
                  float map(float value, float inputMin, float inputMax, float outputMin, float outputMax, bool clamp) {
                  if(clamp == true) {
                  if(value < inputMin) return outputMin;
                  if(value > inputMax) return outputMax;
                  }

                  float p = (outputMax - outputMin) / (inputMax - inputMin);
                  return ((value - inputMin) * p) + outputMin;
                  }
                  </pre>
            <p></code></p>
            <p>map関数は、ある範囲内の値を、別の範囲内にマッピングする関数です。言語によっては実装されていますが、GLSLではないので自分で定義します。</p>
            <p>どういうことかというと、例えば</p>
            <p><code></p>
            <pre class="glsl">
                  map(sin(x), -1.0, 1.0, 0.0, 2.0, true);
                  </pre>
            <p></code></p>
            <p>とするとします。valueにsin関数の値を入れた場合、この値の取りうる範囲は-1.0 ~ 1.0なので、inputMinとinputMaxにはそれぞれ-1.0と1.0を入れます。</p>
            <p>これを、新しい範囲である0.0 ~ 2.0 (outputMin ~ outputMax)の範囲に変換します。sin(x)が-1.0だったら0.0,
                1.0だったら2.0、0.5だったら1.0というような値が帰ってきます。</p>
            <p>clampは、valueがinputMin ~ inputMaxの範囲外の値だった場合に、変換後の値をoutputMin ~ outputMaxの範囲外にならないようにするためのbool値です。</p>
            <p><code></p>
            <pre class="glsl">
                  map(value, -1.0, 1.0, 0.0, 2.0, true);
                  </pre>
            <p></code></p>
            <p>例えばこの例だと、valueが2.0になった場合、clumpの値がtrueであれば2.0となり、falseであれば3.0になるはずです。</p>
            <h3 style="font-size: 16px; font-weight: bold; margin-bottom: 1em;">・hsv2rgb関数</h3>
            <p><code></p>
            <pre class="glsl">
                  // hsvの値をrgbに変換
                  vec3 hsv2rgb(vec3 c) {
                  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
                  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
                  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
                  }
                  </pre>
            <p></code></p>
            <p>hsv2rgbは、<a href="https://ja.wikipedia.org/wiki/HSV%E8%89%B2%E7%A9%BA%E9%96%93"
                           target="_blank">HSV色空間</a>の値をRGBに変換する関数です。引数はHSVの3次元ベクトルです。今回は経過時間とrandomValuesの値を使用して、正方形ごとに別々の色相を割り当てるために使用してます。
            </p>
            <h3 style="font-size: 16px; font-weight: bold; margin-bottom: 1em;">・getAlpha関数</h3>
            <p><code></p>
            <pre class="glsl">
                  // 距離から透明度を計算
                  float getAlpha(float distance) {
                  float da = abs(distance - 400.0) / 500.0;
                  return clamp(1.0 - da, 0.0, 1.0);
                  }
                  </pre>
            <p></code></p>
            <p>こちらはカメラからの距離によって正方形の透明度を変化させるために使用する関数です。カメラから近すぎると透明になり、遠すぎても透明になります。これによって擬似的に奥行きを表現してます。</p>
            <h3 style="font-size: 16px; font-weight: bold; margin-bottom: 1em;">・getRad関数</h3>
            <p><code></p>
            <pre class="glsl">
                  // time, scale, offsetを使って角度を返す
                  // 範囲は -PI ~ PI
                  float getRad(float scale, float offset) {
                  return map(mod(time * scale + offset, PI * 2.0), 0.0, PI * 2.0, -PI, PI, true);
                  }
                  </pre>
            <p></code></p>
            <p>こちらは経過時間timeの値と、引数で与えられた係数と位相差を使って、-PI ~ PIの範囲の角度を算出するための関数です。</p>
            <p>単純にtime * scale + offsetだと値がどんどん大きくなってしまうので、mod関数を使用して0.0 ~ 2.0 * PIの間に値を収めたあと、map関数で-PI ~
                PIの範囲に設定し直しています。</p>
            <p>0.0 ~ 2.0 * PIでもいい気がしますが、何でこうしたかは忘れましたｗ</p>
            <h3 style="font-size: 16px; font-weight: bold; margin-bottom: 1em;">・main関数</h3>
            <p>やっとmain関数にたどり着きました。。</p>
            <p>まずは3種類のアニメーションの箇所に注目してください。動きに関しては後述しますが、それぞれのアニメーションの計算において、要所要所でanimationValue1, 2,
                3の値がかけられているのがわかるかと思います。</p>
            <p>これらによって、</p>
            <p>・animationValue1が1でanimationValue2, 3が0のときはanimation1が適用される<br/>
                ・animationValue2が1でanimationValue1, 3が0のときはanimation2が適用される<br/>
                ・animationValue3が1でanimationValue1, 2が0のときはanimation3が適用される</p>
            <p>という動きを実現しています。</p>
            <p>そしてMainVisualクラスで定義されていたanimateメソッドを使用してこれらの値をスムーズに切り替えれば、2つのアニメーション間をスムーズに切り替える動きが可能になるということです。</p>
            <p>ではアニメーションの計算ではなくまずはフラグメントシェーダに渡すUV座標の計算部分を見てみます。</p>
            <p><code></p>
            <pre class="glsl">
                  //
                  // フラグメントシェーダにに渡すUV座標を計算
                  //

                  // テクスチャ上の何番目の文字を使うか
                  float txtTextureIndex = mod(charIndex, textureTxtLength);

                  // テクスチャの横方向のグリッド単位
                  float uUnit = 1.0 / numTextureGridCols;

                  // テクスチャの縦方向のグリッド単位
                  float vUnit = 1.0 / numTextureGridRows;

                  // フラグメントシェーダに渡すUV座標を代入
                  vUv = vec2(
                  (uv.x + mod(txtTextureIndex, numTextureGridCols)) * uUnit,
                  (uv.y + floor(txtTextureIndex / numTextureGridCols)) * vUnit
                  );
                  </pre>
            <p></code></p>
            <p>
                txtTextureIndexはコメントにある通りテクスチャ上の何文字目を使うかの値です。例えば今回のサンプルでは62文字を使用しているので、mod関数でcharIndexをtextureTxtLengthで割れば、テクスチャの何番目の文字を使うかが算出できます。</p>
            <p>たとえば、charIndexが62のときは、一周回ってtxtTextureIndexは0になるので、0文字目(1文字目)となります。</p>
            <p>uUnitは横方向の1文字分、vUnitは縦方向の1文字分のUV座標の幅です。UV座標はそれぞれの成分が0.0 ~ 1.0なので、横方向に16文字、縦方向に4文字描画されたテクスチャだとすると、</p>
            <p>0枚目正方形において</p>
            <p><code></p>
            <pre class="glsl">
                  // 左上の頂点
                  vUv = vec2(0.0, 0.0);

                  // 右上の頂点
                  vUv = vec2(uUnit, 0.0);

                  // 左下の頂点
                  vUv = vec2(0.0, vUnit);

                  // 右下の頂点
                  vUv = vec2(uUnit, vUnit);
                  </pre>
            <p></code></p>
            <p>となります。つまり、一般化すると、</p>
            <p><code></p>
            <pre class="glsl">
                  // 左上の頂点
                  vUv = vec2(0.0 + uUnit * [左から何個目の文字か], 0.0 + vUnit * [上から何個目の文字か]);

                  // 右上の頂点
                  vUv = vec2(uUnit + uUnit * [左から何個目の文字か], 0.0 + vUnit * [上から何個目の文字か]);

                  // 左下の頂点
                  vUv = vec2(0.0 + uUnit * [左から何個目の文字か], vUnit + vUnit * [上から何個目の文字か]);

                  // 右下の頂点
                  vUv = vec2(uUnit + uUnit * [左から何個目の文字か], vUnit + vUnit * [上から何個目の文字か]);
                  </pre>
            <p></code></p>
            <p>こんな感じになるかと思います。この計算を上記の部分のコードで実現してます。</p>
            <p>次は座標の変換と、文字色の部分です。</p>
            <p><code></p>
            <pre class="glsl">
                  //
                  // 最終的な座標とフラグメントシェーダに渡す文字色を計算
                  //

                  // モデル変換
                  vec4 modelPos = modelMatrix * vec4(pos, 1.0);

                  // ビュー変換
                  vec4 modelViewPos = viewMatrix * modelPos;

                  // ビルボードのための処理 (animation1)
                  modelViewPos += vec4(position, 0.0) * animationValue1;

                  // プロジェクション変換した座標をgl_Positionに代入
                  gl_Position = projectionMatrix * modelViewPos;

                  // カメラからの距離を算出
                  float d = distance(cameraPosition, modelPos.xyz);

                  // フラグメントシェーダに渡すcolorを計算
                  // 時間経過でHSVのHが徐々に変化
                  // 距離に応じてalphaの値が変化
                  vColor = vec4(hsv2rgb(
                  vec3(
                  (sin(getRad(2.0, randomValues.x * 2.0)) + 1.0) * 0.5,
                  0.8,
                  0.8
                  )
                  ), getAlpha(d));
                  </pre>
            <p></code></p>
            <p>posはアニメーションを適用した頂点座標です。</p>
            <p>まずはposにモデル変換をしますが、今回はMesh (FloatingChars)に対して変形をかけてない
                (座標の移動はすべて頂点シェーダ内で行っている)ので、posにmodelMatrixをかけてもかけなくても結果は変わりません。がFloatingChars自体を変形した場合はこの処理ないと適用されないので、省略はしないでおきます。続いてビュー変換も行います。モデル変換した座標を変数に代入して保持しているのは、後ほどカメラとの距離を出すためです。</p>
            <p><code></p>
            <pre class="glsl">
                  // ビルボードのための処理 (animation1)
                  modelViewPos += vec4(position, 0.0) * animationValue1;
                  </pre>
            <p></code></p>
            <p>ここは一旦飛ばします。animatoin1絡みなのはおわかりかと思います。</p>
            <p>このあと、プロジェクション変換した最終的な座標をgl_Positionに代入します。</p>
            <p>その下からは文字色
                (vColor)を計算するための処理です。先程説明しましたがカメラとモデル変換した座標の距離を算出します。getAlpha関数を使って、距離から座標の透明度を算出し、vColorのalpha成分としてます。</p>
            <p>vColorのrgb成分は、hsv2rgb関数で算出します。HSVのSとVは今回は固定しています (ここも時間経過などで変えたらさらに色にばらつきが出ます)。</p>
            <p>HはgetRad関数の引数にrandomValues.xを使用して、文字によって色のばらつきをもたせつつ時間経過で色が変わるようにしてます。Hの値は0.0 ~
                1.0なので、1を足して2で割って(0.5をかけて)ます。map関数を使ってもいいと思いますが、使うまでもないでしょう。</p>
            <p>ここで決定したvColorがフラグメントシェーダに渡されます。</p>
            <p>さて、やっとアニメーション部分の解説です。もうしんどいです。読んでる方もしんどいかと思いますが。。これで最後です。</p>
            <p>まず、animation2とanimation3はそんなに難しくない話なので、先に解説します。</p>
            <h3 style="font-size: 16px; font-weight: bold; margin-bottom: 1em;">・animation2</h3>
            <p><code></p>
            <pre class="glsl">
                  //
                  // animation2
                  // 8個のリング状
                  //

                  float numRings = 8.0;  // リングの個数
                  float ringIndex = mod(charIndex, numRings);  // どのリングに属するか
                  float numCharsPerRing = numChars / numRings;  // リングごとの文字数

                  // 4段階にリングの位置を設定
                  pos.y += animationValue2 * map(ringIndex, 0.0, numRings - 1.0, -60.0, 60.0, true);
                  pos.z += animationValue2 * radius;  // まず手前にradius分移動

                  // y軸を中心にリング状になるように文字を配置
                  theta = getRad(10.0, PI * 2.0 / numCharsPerRing * mod((charIndex - ringIndex) / numRings, numCharsPerRing));
                  pos = rotateVec3(pos, animationValue2 * theta, vec3(0.0, 1.0, 0.0));
                  </pre>
            <p></code></p>
            <p>animation2は、文字を8つのリング上に配置して、回転させるというものです。</p>
            <p>まずは正方形がどのリングに属するかの値ringIndexを決めて、ringIndexによってリングのy座標を決めたあと、リング状に配置しています。</p>
            <p>
                リング状に配置するには、まずz方向にリングの半径分移動し、そのあとy軸を中心に一文字ずつ角度をずらして配置していきます。その際の角度の計算にgetRad関数を使用して経過時間を絡めているので回転するアニメーションが付いています。</p>
            <h3 style="font-size: 16px; font-weight: bold; margin-bottom: 1em;">・animation3</h3>
            <p><code></p>
            <pre class="glsl">
                  //
                  // animation3
                  // 球面上の移動
                  //

                  pos.z += animationValue3 * radius;
                  theta = getRad(6.0, randomValues.x * 10.0);
                  pos = rotateVec3(pos, animationValue3 * theta, vec3(0.0, 1.0, 0.0));
                  theta = getRad(6.0, randomValues.y * 10.0);
                  pos = rotateVec3(pos, animationValue3 * theta, vec3(1.0, 0.0, 0.0));
                  theta = getRad(6.0, randomValues.z * 10.0);
                  pos = rotateVec3(pos, animationValue3 * theta, vec3(0.0, 0.0, 1.0));
                  </pre>
            <p></code></p>
            <p>続いてはanimation3です。これはanimaion2よりもずっと単純です。こちらもまずz方向に球の半径分移動し、そのあとx, y, z軸を中心に適当に回転させているだけです。</p>
            <p>それぞれの軸の回転はgetRad関数にrandomValuesの値を引数として入れて算出しているので、文字ごとにランダムにアニメーションします。</p>
            <h3 style="font-size: 16px; font-weight: bold; margin-bottom: 1em;">・animation1</h3>
            <p>最後にずっと飛ばしてきたanimation1の解説をします。</p>
            <p><code></p>
            <pre class="glsl">
                  //
                  // animation1
                  // ビルボード
                  //

                  pos -= animationValue1 * position;
                  theta = getRad(4.0, (randomValues.x + randomValues.y + randomValues.z) * 20.0);
                  pos.z += animationValue1 * (radius + radius * map(sin(theta), -1.0, 1.0, 0.0, 1.0, true));
                  theta = getRad(4.0, randomValues.x * 20.0);
                  pos = rotateVec3(pos, animationValue1 * theta, vec3(0.0, 1.0, 0.0));
                  theta = getRad(4.0, randomValues.y * 20.0);
                  pos = rotateVec3(pos, animationValue1 * theta, vec3(1.0, 0.0, 0.0));
                  theta = getRad(4.0, randomValues.z * 20.0);
                  pos = rotateVec3(pos, animationValue1 * theta, vec3(0.0, 0.0, 1.0));
                  </pre>
            <p></code></p>
            <p>animation1は他のアニメーションと違い、正方形の面が常にカメラの方向を向いているビルボードと呼ばれる手法を使ってます。</p>
            <p>頂点シェーダは頂点ごとの処理ではありますが、正方形ごとに変形するイメージで考えてみてください。animation1は変形的にはanimation3に近いです。</p>
            <p>まずz方向にせり出して、x, y, z軸を中心にランダムに回転してます。また、最初にz方向にせり出す距離も時間経過で変化させてます。</p>
            <p>ただ、そのままだとanimation3のように面の方向がカメラの正面を向かないです。なので、最初に正方形の4頂点をギュッと潰して原点に移動させてしまいます。</p>
            <p><code></p>
            <pre class="glsl">
                  pos -= animationValue1 * position;
                  </pre>
            <p></code></p>
            <p>そしてanimation3のように変形させます。その後、ビュー変換を行ったあとの座標に、潰した分を加算してもとに戻します。先程とばした以下の部分です。</p>
            <p><code></p>
            <pre class="glsl">
                  // ビルボードのための処理 (animation1)
                  modelViewPos += vec4(position, 0.0) * animationValue1;
                  </pre>
            <p></code></p>
            <p>なんでこれでカメラの方に向くかというと、ビュー変換をした座標はカメラの見え方が反映された状態です。つまりカメラの目線とz軸が平行になっているイメージです。</p>
            <p>その状態で潰していた正方形を元に戻すと、全部がカメラの方向に向いたビルボードを実現できる、というわけです。</p>
            <p>ただこのやり方があっているかどうかはよくわかりませんが、なんとなくできてるような気がしますｗ</p>
            <p>さて、死ぬほど長くなってしまいましたが、以上で解説を終わります。three.jsは使ったことあるけどシェーダはまだ、、という方はぜひ参考にしてみてください。</p>

        </div>
        <div id="disqus_thread"></div>
    </div>
</article>
<h2 class="relatedTtl">Related Posts</h2>
<section class="articles">
    <article><a href="detail.html">
        <div class="thumb"><img src="https://dev.tkmh.me/wp/wp-content/uploads/2016/03/thumb.png"></div>
        <h2 class="ttl">タイトルタイトルタイトルタイトルタイトルタイトルタイトルタイトル</h2>
        <p class="date">2016.06.20</p></a></article>
    <article><a href="#">
        <div class="thumb"><img src="https://dev.tkmh.me/wp/wp-content/uploads/2016/03/thumb.png"></div>
        <h2 class="ttl">タイトルタイトルタイトルタイトルタイトルタイトルタイトルタイトル</h2>
        <p class="date">2016.06.20</p></a></article>
    <article><a href="#">
        <div class="thumb"><img src="https://dev.tkmh.me/wp/wp-content/uploads/2016/03/thumb.png"></div>
        <h2 class="ttl">タイトルタイトルタイトルタイトルタイトルタイトルタイトルタイトル</h2>
        <p class="date">2016.06.20</p></a></article>
</section>


</div>

<script>
    (function () {
        var cx = '007994074685004545182:xupd0xvbvn8';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
    })();
</script>
<style>
    form.gsc-search-box {
        display: none;
    }
</style>
<gcse:search></gcse:search>


        </div>
        <p class="btnScrollTop"><a href="#">Top</a></p>
    </section>
    <div id="svgDef">
        <svg version="1.1" id="svgDef" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <defs>
                <path id="iconPinterest" d="M131.7,50.1c-3.7-26.6-30.2-40.1-58.4-37c-22.4,2.5-44.6,20.6-45.6,46.4c-0.6,15.8,3.9,27.6,18.9,30.9
              c6.5-11.5-2.1-14-3.4-22.4c-5.5-34.1,39.3-57.3,62.8-33.5c16.2,16.5,5.5,67.2-20.6,61.9c-25.1-5,12.3-45.4-7.7-53.3
              c-16.3-6.4-24.9,19.7-17.2,32.7c-4.5,22.3-14.3,43.3-10.3,71.3c12.8-9.3,17.1-27,20.6-45.6c6.4,3.9,9.9,8,18.1,8.6
              C119,112.6,135.9,80.1,131.7,50.1z"/>
                <path id="iconTwitter" d="M149.5,36.9c-5.1,2.3-10.6,3.8-16.4,4.5c5.9-3.5,10.4-9.1,12.5-15.8c-5.5,3.3-11.6,5.6-18.1,6.9
              c-5.2-5.5-12.6-9-20.8-9c-15.7,0-28.5,12.8-28.5,28.5c0,2.2,0.3,4.4,0.7,6.5C55.3,57.4,34.3,46,20.2,28.8c-2.5,4.2-3.9,9.1-3.9,14.3
              c0,9.9,5,18.6,12.7,23.7c-4.7-0.2-9.1-1.4-12.9-3.6v0.4c0,13.8,9.8,25.3,22.9,28c-2.4,0.6-4.9,1-7.5,1c-1.8,0-3.6-0.2-5.4-0.5
              c3.6,11.3,14.2,19.6,26.6,19.8C43,119.5,30.7,124,17.3,124c-2.3,0-4.6-0.1-6.8-0.4c12.6,8.1,27.6,12.8,43.7,12.8
              c52.4,0,81.1-43.4,81.1-81.1l-0.1-3.7C140.8,47.6,145.7,42.6,149.5,36.9z"/>
                <path id="iconGithub" d="M102.4,143c-0.6,0.2-1.3,0.5-1.9,0.6c-2.5,0.4-4.1-0.8-4.1-3.4c0-4.8,0-9.5,0-14.3c0.1-5.5,0-10.9-4.2-15.4
              c2.5-0.4,4.7-0.8,6.8-1.2C113.3,106,120.7,97,121.6,82c0.5-7.6-0.9-14.6-5.9-20.6c-0.4-0.4-0.4-1.4-0.2-2c1.3-5,1-9.8-0.6-14.6
              c-0.4-1.2-1-1.6-2.2-1.5c-4.2,0.2-8,1.7-11.4,4C98,49.5,94.9,50,91,49.1c-8.5-1.9-17.1-1.4-25.7,0.6c-1,0.2-2.3-0.1-3.1-0.6
              c-4-2.3-8-4.6-12.6-5.5c-3.6-0.7-3.9-0.5-4.8,2.9c-1.2,4.3-1.3,8.7-0.1,13.1c0.2,0.6,0,1.7-0.4,2.1c-9.5,10.5-6,30.5,0.3,38.1
              c5,5.9,11.5,8.6,18.8,10c1.3,0.2,2.5,0.4,3.8,0.6c-1.1,2.8-2.1,5.5-3.2,8.2c-0.2,0.5-0.9,0.9-1.5,1.2c-7.2,2.8-13.3,0.7-17.4-5.8
              c-2.2-3.5-5-6.1-9.2-6.8c-0.1,0-0.3-0.1-0.4-0.1c-1.1,0.3-2.2,0.6-3.4,0.9c0.6,0.9,1.1,2.1,1.9,2.6c3.6,2.3,5.9,5.5,7.4,9.2
              c2.4,5.9,7.1,8.6,13.1,9.1c3,0.2,5.9,0,9.2,0c0,3.7,0.1,7.9-0.1,12.1c-0.1,2.3-2.4,3.2-5.1,2.2c-7.2-2.5-13.9-6-19.6-11
              c-20.8-17.9-28.8-40.6-21.9-67.1C24,38.8,42,22.5,68.9,17.4c37.2-7,72.4,20,76.1,57.8C147.9,105,130.4,132.8,102.4,143z M67.3,110.3
              c0,0.1,0,0.1-0.1,0.1c0.1,0,0.1,0,0.2,0C67.5,110.5,67.6,110.6,67.3,110.3z M50.5,122c0.6,0.4,1.1,0.8,1.8,1c0.2,0.1,0.7-0.4,1.4-1
              c-1-0.4-1.7-0.7-2.3-0.8C51.1,121.2,50.8,121.8,50.5,122z M55.8,123c0.1,0.4,0.9,0.9,1.3,0.9c0.4,0,0.9-0.6,1.3-0.9
              c-0.4-0.4-0.8-0.7-2-1.8C56.1,121.8,55.7,122.5,55.8,123z M62.3,121.4c-0.5,0.1-1,0.6-1.5,1c0.3,0.4,0.6,0.7,1.1,1.3
              c0.6-0.6,1.1-1,1.5-1.4C63,121.9,62.6,121.3,62.3,121.4z M46.2,119.2c0.3,0.6,0.8,1.1,1.4,1.9c0.4-0.7,0.9-1.2,0.8-1.3
              c-0.4-0.5-1-1-1.5-1.4C46.9,118.4,46.1,119.1,46.2,119.2z"/>
                <path id="iconFlickr" d="M21.9,80c0,14,11.4,25.4,25.4,25.4S72.7,94,72.7,80c0-14-11.4-25.4-25.4-25.4S21.9,66,21.9,80z M87.3,80
              c0,14,11.4,25.4,25.4,25.4S138.1,94,138.1,80c0-14-11.4-25.4-25.4-25.4S87.3,66,87.3,80z"/>
                <path id="iconFacebook" d="M61.3,39.7c0-0.8,0.1-2.6,0.3-5.3c0.2-2.7,1.3-5.5,3.1-8.5c1.8-3,4.8-5.6,8.9-8c4.1-2.3,10-3.5,17.7-3.5
              H113v23.6H97.1c-1.6,0-3,0.6-4.4,1.8c-1.3,1.2-2,2.3-2,3.3v14.7H113c-0.2,2.9-0.5,5.7-0.8,8.4l-0.9,7.1c-0.4,2.4-0.7,4.7-1.1,6.7
              H90.6v65.5H61.3V80H47V57.8h14.3V39.7z"/>
                <path id="iconTumblr" d="M87.5,72.5v27.4c0,6.9-0.1,10.9,0.6,12.9c0.7,2,2.6,4,4.6,5.2c2.6,1.6,5.7,2.4,9.1,2.4
              c6.1,0,9.6-0.8,15.6-4.7v18l0,0c-5.1,2.4-9.6,3.8-13.7,4.8c-4.1,1-8.6,1.4-13.4,1.4c-5.5,0-8.7-0.7-12.9-2.1
              c-4.2-1.4-7.8-3.4-10.7-5.9c-3-2.6-5-5.3-6.2-8.2c-1.1-2.9-1.7-7.1-1.7-12.5V69.2H42.6V52.3c4.7-1.5,9.9-3.7,13.3-6.6
              c3.4-2.9,6-6.3,8.1-10.3c2-4,3.4-9.1,4.2-15.2h19.3l0,29.9h29.9v22.4H87.5z"/>
                <path id="iconInstagram" fill-rule="evenodd" clip-rule="evenodd" d="M35.5,20.1h89c8.5,0,15.4,6.9,15.4,15.4v89
              c0,8.5-6.9,15.4-15.4,15.4h-89c-8.5,0-15.4-6.9-15.4-15.4v-89C20.1,27.1,27.1,20.1,35.5,20.1L35.5,20.1z M107.3,33.4
              c-3,0-5.4,2.4-5.4,5.4v12.9c0,3,2.4,5.4,5.4,5.4h13.5c3,0,5.4-2.4,5.4-5.4V38.8c0-3-2.4-5.4-5.4-5.4H107.3L107.3,33.4z M126.3,70.8
              h-10.5c1,3.3,1.5,6.7,1.5,10.3c0,19.9-16.7,36.1-37.2,36.1c-20.6,0-37.2-16.1-37.2-36.1c0-3.6,0.5-7,1.5-10.3h-11v50.6
              c0,2.6,2.1,4.8,4.8,4.8h83.4c2.6,0,4.8-2.1,4.8-4.8V70.8L126.3,70.8z M80.1,56.4c-13.3,0-24,10.4-24,23.3s10.8,23.3,24,23.3
              c13.3,0,24-10.4,24-23.3S93.4,56.4,80.1,56.4z"/>
                <path id="logoTxt"
                      d="M146.248993,37.601002 L36,354.5 L36,378 L53.431999,378 L70.863998,378 L72.931999,375.096008 C74.834999,372.423004 75,370.78299 75,354.5 C75,333.944 74.158997,331 68.283997,331 L65,331 L65,352 L65,373 L55.477001,373 L45.955002,373 L46.227001,354.75 L46.5,336.5 L53.164001,336.205994 C58.967999,335.950012 60.035,335.596008 61.437,333.455994 L63.046001,331 L49.522999,331 L36,331 L36,354.5 M95.096001,334.216003 C93.348,339.522003 83,376.355011 83,377.269012 C83,377.727997 85.325996,377.968994 88.167999,377.802002 C93.317001,377.501007 93.343002,377.483002 94.917999,372.979004 C97.292,366.192993 97.542,366 103.952003,366 C108.348999,366 109.934998,365.609985 110.392998,364.417999 C111.558998,361.380005 110.959,361 105,361 C97.805,361 97.874001,361.312988 101.833,346.572998 C106.041,330.911011 106.524002,331.428986 113.898003,359.5 L118.626999,377.5 L123.813004,377.802002 C129.923996,378.15799 129.802994,378.684998 126.355003,366.696014 C124.901001,361.638 122.087997,351.649994 120.105003,344.5 L116.5,331.5 L106.338997,331.216003 L96.178001,330.932007 L95.096001,334.216003 M137,354.5 L137,378 L148.845001,378 C159.378006,378 160.888,377.781006 162.481003,376.020996 C164.757996,373.505005 163.852997,373.135986 154.5,372.772003 L147.5,372.5 L147.5,354.5 L147.5,336.5 L160.888,336 C173.641006,335.523987 174.315002,335.393005 175.106003,333.25 L175.936005,331 L156.468002,331 L137,331 L137,354.5 M221,337.377991 C221,344.174011 220.203003,345.572998 216,346.153992 C212.166,346.68399 212.875,349.411011 217,350 L220.5,350.5 L220.778,364.25 L221.056,378 L225.5,378 L229.944,378 L230.222,364.25 L230.5,350.5 L233.996002,350.167999 C240.501007,349.550995 242.313004,346 236.121994,346 C228.473999,346 226.931,335.790009 234.487,335.175995 C238.119003,334.880005 239.944,333.743011 239.985001,331.75 C239.992996,331.337006 235.725006,331 230.5,331 L221,331 L221,337.377991 M289,361.493011 L289,377.985992 L293.25,377.835999 C298.894012,377.636993 298.946991,377.484985 298.283997,363.45401 C297.651001,350.044006 297.640991,350.069 303.954987,349.041992 C312.410004,347.667999 308.858002,345 298.572998,345 L289,345 L289,361.493011 M311.463013,346.235992 C311.178009,346.980011 311.069,354.317993 311.221985,362.544006 L311.5,377.5 L316,377.5 L320.5,377.5 L320.5,361.5 L320.5,345.5 L316.240997,345.191986 C313.355011,344.983002 311.813995,345.320007 311.463013,346.235992 M247,362 L247,378 L262.950012,378 C279.821014,378 283.174011,377.031006 279.390991,373.247986 C278.346008,372.20401 278,368.635986 278,358.928986 L278,346 L273.528015,346 L269.056,346 L268.778015,359.75 L268.5,373.5 L263,373.5 L257.5,373.5 L257.217987,361.777008 C256.90799,348.867004 256.444,349.839996 263.416992,348.789001 C269.901001,347.812012 265.462006,346 256.583008,346 L247,346 L247,362 M328,355 L328,364 L335.928986,364 C341.803009,364 344.264008,363.592987 345.428986,362.428986 C347.996002,359.860992 347.26001,359 342.5,359 L338,359 L338,354.5 L338,350 L347.964996,350 C356.906006,350 358.040009,349.795013 359,348 C360.049988,346.039001 359.76001,346 344.035004,346 L328,346 L328,355 M157,352.451996 C157,354.609985 157.371002,354.858002 160.080994,354.515015 C165.817993,353.789001 166,354.161011 166,366.606995 L166,378 L171,378 L176,378 L176,364 L176,350 L166.5,350 C157.082001,350 157,350.020996 157,352.451996 M349.93399,359.75 C349.89801,360.162994 349.785004,363.194 349.68399,366.487 C349.467987,373.498993 349.132996,373.677002 335.75,373.881989 C328.705994,373.989014 328,374.182007 328,376 C328,377.914001 328.666992,378 343.5,378 L359,378 L359,368.5 L359,359 L354.5,359 C352.024994,359 349.970001,359.337006 349.93399,359.75 "
                />
                <!-- path id="logoTxt2"
                      d="M10.5,5.4H0V0h26.2v5.4H15.9v31.7h-5.5V5.4H10.5z M58.3,37.1l-2.1-5H38.9l-2.2,5h-5.5L47.5,0l16.3,37.1H58.3z M41.2,26.6
            	h12.5l-6.2-14.7L41.2,26.6z M79.8,0v16.5L92,0h6.7L87.8,14.9l11.9,22.2h-6.1l-9.3-17.2l-4.4,6v11.2h-5.5V0H79.8z M110.2,0h5.5v24.2
            	c0,0.3,0.1,0.8,0.3,1.6c0.2,0.8,0.6,1.7,1.2,2.5c0.6,0.9,1.4,1.6,2.5,2.3c1.1,0.7,2.5,1,4.3,1s3.2-0.3,4.3-1s1.9-1.4,2.5-2.3
            	s1-1.7,1.2-2.5s0.3-1.3,0.3-1.6V0h5.5v24.2c0,0.2,0,0.7-0.2,1.4c-0.1,0.7-0.3,1.5-0.6,2.5s-0.8,2-1.4,3c-0.6,1.1-1.4,2-2.4,3
            	c-1,0.9-2.3,1.6-3.8,2.2c-1.5,0.6-3.3,0.9-5.4,0.9s-3.9-0.3-5.4-0.8s-2.8-1.2-3.8-2.1c-1-0.9-1.8-1.8-2.4-2.8s-1.1-2-1.4-3
            	s-0.5-1.8-0.6-2.6c-0.1-0.8-0.1-1.3-0.1-1.6V0H110.2z M149.3,0l14.8,16.9L178.9,0v37.1h-5.4V14.2l-9.3,10.3L154.8,14v23h-5.5V0z
            	 M196.4,37.1H191V0h5.5v37.1H196.4z M5.5,59v16.3h15.3V59h5.5v37.1h-5.5V80.5H5.5v15.6H0V59H5.5z M63.8,96.1l-2.1-5H44.4l-2.2,5
            	h-5.5L53,59l16.3,37.1H63.8z M46.8,85.6h12.5L53,70.9L46.8,85.6z M90.4,59c1.3,0,2.5,0.1,3.5,0.4c1,0.2,1.9,0.5,2.7,0.8
            	c0.9,0.4,1.6,0.7,2.2,1.1L96,66.1c-0.5-0.3-1.1-0.6-1.7-0.8c-0.5-0.2-1.1-0.4-1.8-0.6c-0.7-0.2-1.4-0.3-2.2-0.3
            	c-0.9,0-1.6,0.1-2.2,0.4s-1.1,0.7-1.5,1.1s-0.7,0.9-0.9,1.4c-0.2,0.5-0.3,1-0.3,1.4c0,1.3,0.5,2.2,1.4,2.8c0.9,0.6,2.1,1.1,3.4,1.5
            	c1.4,0.4,2.9,0.8,4.5,1.1c1.6,0.4,3.1,0.9,4.5,1.7s2.5,1.8,3.4,3.2c0.9,1.3,1.4,3.2,1.4,5.6c0,1.5-0.3,3-0.9,4.4s-1.5,2.6-2.7,3.6
            	s-2.6,1.8-4.3,2.4c-1.7,0.6-3.6,0.9-5.8,0.9c-1.7,0-3.2-0.2-4.5-0.5s-2.5-0.8-3.5-1.3s-1.9-1-2.6-1.6c-0.7-0.5-1.4-1-2-1.4l2.8-4.8
            	c2,1.6,3.8,2.6,5.5,3.2s3.1,0.8,4.2,0.8c1,0,2-0.1,3-0.4s1.9-0.6,2.7-1.1c0.8-0.5,1.4-1.1,1.9-1.8c0.5-0.7,0.7-1.6,0.7-2.5
            	c0-1.1-0.3-1.9-0.8-2.6s-1.2-1.2-2.1-1.7s-1.9-0.8-3-1.1c-1.1-0.3-2.2-0.6-3.4-0.9c-1.2-0.3-2.3-0.7-3.4-1.1s-2.1-1-3-1.7
            	C82.2,75,81.5,74.1,81,73s-0.8-2.4-0.8-4c0-1.9,0.4-3.5,1.2-4.8s1.8-2.3,2.8-3c1.1-0.8,2.2-1.3,3.4-1.6C88.7,59.2,89.7,59,90.4,59z
            	 M139,59v5.1h-17.3v11.2h14v5.2h-14v10.4H139v5.2h-22.8V59H139z M179.8,78.1v14.1c-1.6,1.3-3.4,2.3-5.4,2.9S170.3,96,168,96
            	c-2.6,0-5-0.5-7.2-1.5s-4.2-2.3-5.9-4s-3-3.7-4-5.9s-1.5-4.7-1.5-7.2c0-2.6,0.5-5,1.5-7.2s2.3-4.2,4-5.9c1.7-1.7,3.7-3,5.9-4
            	s4.7-1.4,7.2-1.4c1.4,0,2.7,0.1,3.9,0.4c1.2,0.2,2.2,0.6,3.2,0.9c1,0.4,1.8,0.8,2.6,1.3s1.5,0.9,2,1.4l-2.7,5.3
            	c-0.4-0.4-0.9-0.9-1.5-1.3s-1.3-0.8-2.1-1.2c-0.8-0.3-1.6-0.6-2.5-0.8c-0.9-0.2-1.8-0.3-2.8-0.3c-1.8,0-3.5,0.3-5,1
            	c-1.6,0.7-2.9,1.6-4.1,2.8c-1.2,1.2-2.1,2.5-2.8,4.1s-1,3.2-1,5s0.3,3.5,1,5c0.7,1.6,1.6,2.9,2.8,4.1s2.5,2.1,4.1,2.8
            	c1.6,0.7,3.2,1,5,1c1,0,2-0.1,3-0.4s1.9-0.7,2.5-1.1v-5.7h-10.7l3-5.2L179.8,78.1L179.8,78.1z M216.3,96.1l-2.1-5H197l-2.2,5h-5.5
            	L205.6,59l16.3,37.1H216.3z M199.3,85.6h12.5l-6.2-14.7L199.3,85.6z M259.2,59h6.2l-15.8,37.1l-5.8-13.2l-5.6,13.2L221.9,59h6.1
            	l10.2,22.4l2.5-5.8L234,60.4h6.2l9.4,21L259.2,59z M292.4,96.1l-2.1-5H273l-2.2,5h-5.5L281.7,59L298,96.1H292.4z M275.4,85.6h12.5
            	l-6.2-14.7L275.4,85.6z"
                / -->
                <g id="logoTxt2" transform="translate(0.000000,130.000000) scale(0.100000,-0.100000)"
                   fill="#000000" stroke="none">
                    <path d="M540 1014 c-60 -34 -70 -49 -70 -110 l0 -53 56 -32 57 -32 54 29 54
29 -3 68 -3 68 -50 29 -51 29 -44 -25z"/>
                    <path d="M318 892 c-23 -14 -28 -24 -28 -57 0 -37 3 -43 36 -58 35 -17 37 -17
70 4 29 17 34 26 34 58 0 33 -4 39 -35 54 -43 21 -43 21 -77 -1z"/>
                    <path d="M710 801 l-135 -78 -3 -171 -2 -171 92 -54 c51 -30 116 -67 143 -82
l51 -28 142 82 142 83 0 168 0 168 -139 81 c-77 45 -144 81 -148 81 -4 -1 -69
-36 -143 -79z"/>
                    <path d="M1390 565 l0 -205 163 0 163 0 17 29 c14 24 17 55 17 180 0 176 -8
201 -66 201 l-34 0 0 -180 0 -180 -80 0 -80 0 0 155 0 155 61 0 c47 0 65 4 75
18 7 9 14 20 14 25 0 4 -56 7 -125 7 l-125 0 0 -205z"/>
                    <path d="M1862 578 c-30 -105 -56 -197 -59 -205 -4 -10 8 -13 50 -13 l55 0 12
50 12 50 57 0 c52 0 59 3 69 25 l12 25 -61 0 c-53 0 -60 2 -55 18 3 9 14 55
25 101 11 46 23 86 26 89 11 11 19 -14 64 -187 l45 -171 54 0 c39 0 53 3 50
13 -3 6 -29 99 -59 204 l-54 193 -95 0 -95 0 -53 -192z"/>
                    <path d="M2270 565 l0 -205 115 0 c94 0 117 3 121 15 4 8 11 15 16 15 6 0 8
-7 4 -15 -4 -12 5 -15 48 -15 52 0 53 1 50 28 -1 15 -2 71 -3 125 l-1 97 -85
0 c-83 0 -85 0 -85 -24 0 -21 5 -25 38 -28 l37 -3 0 -70 0 -70 -77 -3 -78 -3
0 156 0 155 120 0 c66 0 120 4 120 9 0 5 3 16 6 25 5 14 -13 16 -170 16 l-176
0 0 -205z"/>
                    <path d="M3000 710 l0 -60 -30 0 c-25 0 -30 -4 -30 -25 0 -21 5 -25 30 -25
l30 0 0 -120 0 -120 45 0 44 0 3 118 3 117 38 3 c20 2 37 7 37 12 0 5 3 15 6
24 5 13 -2 16 -41 16 l-46 0 3 38 c3 35 5 37 39 40 27 2 38 9 42 23 5 18 -1
19 -84 19 l-89 0 0 -60z"/>
                    <path d="M352 699 l-52 -31 0 -67 0 -67 53 -29 54 -28 54 31 55 31 -4 63 c-4
71 -2 66 -62 101 l-45 26 -53 -30z"/>
                    <path d="M3230 505 l0 -145 145 0 c128 0 146 2 152 17 4 9 1 19 -5 21 -8 2
-12 41 -12 128 l0 124 -140 0 -140 0 0 -145z m185 -92 c-3 -10 -18 -13 -47
-11 l-43 3 -3 98 -3 97 35 0 c26 0 39 6 48 23 11 19 13 8 16 -87 1 -61 0 -116
-3 -123z"/>
                    <path d="M3590 504 l0 -145 48 3 47 3 3 118 3 117 28 0 c18 0 34 8 44 23 15
20 16 12 16 -120 l1 -143 50 0 50 0 0 145 0 145 -145 0 -145 0 0 -146z"/>
                    <path d="M3930 565 l0 -85 79 0 c71 0 80 2 86 20 12 38 25 20 25 -35 l0 -55
-95 0 c-95 0 -95 0 -95 -25 l0 -25 140 0 140 0 0 85 0 84 -92 3 -93 3 -3 33
-3 32 90 0 c79 0 92 2 101 19 5 11 10 22 10 25 0 3 -65 6 -145 6 l-145 0 0
-85z"/>
                </g>
                <!-- path id="logoMark"

                / -->
                <g id="logoMark" transform="translate(0.000000,266.000000) scale(0.100000,-0.100000)"
                   fill="#000000" stroke="none">
                    <path d="M963 2128 l-103 -60 0 -123 0 -123 110 -62 110 -62 93 52 c135 76
127 65 127 194 0 61 -4 116 -8 122 -10 15 -201 124 -215 123 -7 0 -58 -28
-114 -61z"/>
                    <path d="M318 2019 c-36 -18 -38 -22 -38 -67 0 -46 2 -48 43 -71 l43 -23 42
21 c41 21 42 23 42 70 0 46 -3 51 -36 70 -43 25 -49 25 -96 0z"/>
                    <path d="M563 1912 l-63 -36 0 -77 0 -78 66 -39 66 -40 69 40 70 40 -3 76 -3
76 -65 38 c-36 21 -67 37 -70 37 -3 -1 -33 -17 -67 -37z"/>
                    <path d="M1389 1761 c-120 -69 -247 -143 -283 -164 l-66 -38 0 -327 0 -327
277 -160 c152 -88 282 -161 289 -163 7 -2 139 70 294 158 l280 162 -2 330 -3
330 -250 145 c-137 80 -266 153 -285 162 l-35 18 -216 -126z"/>
                    <path d="M615 1521 l-100 -59 -3 -125 -3 -126 68 -39 c37 -22 87 -50 109 -63
l41 -23 104 60 104 60 0 129 0 129 -100 58 c-55 32 -104 58 -110 58 -5 -1 -55
-27 -110 -59z"/>
                </g>
            </defs>
        </svg>

    </div>
</div>
<script src="/assets/js/lib.js" type="text/javascript"></script>
<script src="/assets/js/common.js" type="text/javascript"></script>
<script src="/assets/js/blog.js" type="text/javascript"></script>
</body>
</html>
